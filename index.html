<!doctype html>

<html>

<head>
    <meta charset="utf-8"></meta>
    <title>Conceptoscape</title>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.2.18/cytoscape.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-qtip/2.7.0/cytoscape-qtip.js"></script>
--->
    <script language="JavaScript" type="text/javascript" src='stile.js'></script>
    <script language="JavaScript" type="text/javascript" src='jquery-1.8.3.js'></script>
    <script language="JavaScript" type="text/javascript" src='cytoscape.js'></script>
    <script language="JavaScript" type="text/javascript" src='cytotools.js'></script>

</head>

<style>
    #cyo {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 60px;
        left: 0px;
    }
    select,button{
        /* color: blue; */
        left: 150px;
        width: auto;
        font-family: sans-serif;
        font-weight: bold;
        font-size: 75%;
    }
    em{
        font-family: sans-serif;
    }
    #cc{
        padding-left: 400px;
        padding-bottom: 5px;
        border-bottom-width:1.5px;
        border-bottom-color:black;
        border-bottom-style: solid;
    }
</style>

<body>
    <div id='cc'>
        <em>Choose the type</em>
        <select name = "conorrol">
            <option>---</option>
        </select>
        <em> and the entity</em>
        <select name = "lista">
            <option>---</option>
        </select>
        
        <button onclick= "go()">Draw</button>
    </div>
    <div id = 'cyo'></div>

    <script>
    
        //INIZIO INTERAZIONE
        var listaconcetti = [];
        var listaruoli = [];
        readTextFile("book.json", function(text){
            var data = JSON.parse(text);
            for (el in data.Concepts){
                var obj = data.Concepts[el];
                for(id in obj){
                    listaconcetti.push(id);
                }
            }
            for (el in data.Roles){
                var obj = data.Roles[el];
                for(id in obj){
                    listaruoli.push(id);
                }
            }
        });

        var tipo;
        var soggetto;
        $.each(["Concept","Role"],function(index,elem){
            $('select[name = "conorrol"]').append(new Option(elem,index));
        });
        
        $('select[name = "conorrol"]').live("change",function(){
            if($('select[name = "conorrol"] option:selected').text() == "Role") {
                tipo = "starRole";
                $('select[name = "lista"]').empty();
                $('select[name = "lista"]').append(new Option("---",0));
                $.each(listaruoli,function(index,elem){
                    $('select[name = "lista"]').append(new Option(elem,index));
                });
            }
            if($('select[name = "conorrol"] option:selected').text() == "Concept") {
                tipo = "starConcept";
                $('select[name = "lista"]').empty();
                $('select[name = "lista"]').append(new Option("---",0));
                $.each(listaconcetti,function(index,elem){
                    $('select[name = "lista"]').append(new Option(elem,index));
                });
            }
        })

        $('select[name = "lista"]').live("change",function(){
            var x = $('select[name = "lista"] option:selected').text();
            if(x != "---") soggetto = x;
        })


        //CREAZIONE DELL ELEMENTO CY 
        var cy;
        function go(){
            cy = cytoscape({
                container: document.getElementById('cyo'),
                style: stile
            });
        
            
            
            //INIZIO PARSING DEL JSON
            
            readTextFile("book.json", jparse);

            //FINE PARSING DEL JSON
            
            //INIZIO GESTIONE DEL LAYOUT
            
            cy.layout({
                name:'preset',

            }).run(); 

            var nodes = cy.nodes('node');

            if(tipo == 'starConcept') GrapholyConcept(nodes);
            else GrapholyRole(nodes);

            cy.fit(cy.$id(soggetto),280);
            //FINE GESTIONE LAYOUT
            
            //INIZIO GESTIONE NODI FAKE 

            FakeAttrGen();
            FakeRoleGen();
            FakeManager();

            //FINE GESTIONE NODI FAKE
        }
        
    </script>
    
</body>

